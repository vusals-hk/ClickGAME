<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>WWcoin â€” Clicker with TON Withdraw</title>

  <!-- Monetag SDK (optional) -->
  <script src='//libtl.com/sdk.js' data-zone='10286020' data-sdk='show_10286020'></script>

  <!-- TON Connect SDK (core) -->
  <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect.umd.js"></script>
  <!-- TON Connect UI -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

  <style>
    :root{--bg:#fff7e6;--accent:#f59e0b;--muted:#6b7280}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#fffaf0,#ffffff);display:flex;min-height:100vh;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:980px;background:#fff;border-radius:16px;padding:20px;box-shadow:0 6px 24px rgba(15,23,42,0.06)}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{margin:0;font-size:22px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    .play{display:flex;flex-direction:column;align-items:center;padding:18px;border-radius:12px}
    .big-btn{border:0;border-radius:999px;padding:34px 44px;font-size:44px;cursor:pointer;background:linear-gradient(180deg,#fff4d6,#fde68a);box-shadow:inset 0 -6px 18px rgba(0,0,0,0.04)}
    .stats{width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .energy{width:100%;max-width:420px}
    .bar{height:10px;background:#f1f5f9;border-radius:999px;overflow:hidden}
    .bar > i{display:block;height:100%;background:var(--accent);transition:width .3s}
    .shop{padding:12px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05)}
    .upgrade{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef2f7;margin-bottom:8px}
    button.small{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:#6366f1;color:#fff}
    .muted{color:var(--muted);font-size:13px}
    .ad-buttons{display:flex;gap:8px;margin-top:12px}
    .footer{margin-top:14px;text-align:center;color:#65748b;font-size:13px}
    .withdraw { margin-top:12px; border-top:1px dashed #eef2f7; padding-top:12px; }
    .select, .withdraw button { width:100%; box-sizing:border-box; }
    .select { padding:8px; border-radius:8px; border:1px solid #e6e9ee; margin-bottom:8px; }
    .small-muted { font-size:12px; color:#6b7280; margin-top:6px; }
  </style>
</head>
<body>
  <div class="card" role="application">
    <div class="header">
      <div>
        <h1>WWðŸª™</h1>
        <div class="muted">Convert Coin to "Ton"</div>
      </div>
      <div style="text-align:right">
        <div class="muted">Level</div>
        <div id="level" style="font-weight:700">1</div>
      </div>
    </div>

    <div class="grid">
      <div class="play">
        <div class="stats" style="width:100%">
          <div class="muted">Coins</div>
          <div id="coins" style="font-size:20px;font-weight:700">0</div>
        </div>

        <button id="tapBtn" class="big-btn" aria-label="Tap">ðŸª™</button>

        <div style="width:100%;margin-top:14px;display:flex;flex-direction:column;align-items:center">
          <div class="energy">
            <div style="display:flex;justify-content:space-between;font-size:13px;color:#6b7280;margin-bottom:6px">
              <span>Energy</span>
              <span id="energyText">10/10</span>
            </div>
            <div class="bar"><i id="energyBar" style="width:100%"></i></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="refillBtn" class="small">Refill</button>
              <button id="boostBtn" class="small btn-primary">Activate Boost</button>
            </div>
          </div>
        </div>

        <div id="connectWalletBtn" style="margin-top:12px"></div>
        <div id="walletAddress" class="muted" style="margin-top:6px">Wallet not connected</div>

        <div style="width:100%;display:flex;justify-content:space-between;margin-top:8px">
          <button id="shareBtn" class="small">Share</button>
          <button id="resetBtn" class="small">Reset</button>
        </div>
      </div>

      <aside class="shop">
        <h3 style="margin-top:0;margin-bottom:8px">Withdraw / Convert to TON</h3>

        <div class="withdraw">
          <label for="convertSelect" class="muted">Choose package (coins â†’ TON):</label>
          <select id="convertSelect" class="select">
            <option value="10000">10,000 â†’ 0.1 TON</option>
            <option value="30000">30,000 â†’ 0.3 TON</option>
            <option value="50000">50,000 â†’ 0.5 TON</option>
            <option value="100000">100,000 â†’ 1.0 TON</option>
            <option value="300000">300,000 â†’ 3.0 TON</option>
            <option value="500000">500,000 â†’ 5.0 TON</option>
            <option value="1000000">1,000,000 â†’ 10.0 TON</option>
          </select>

          <div id="selectedInfo" class="small-muted">Wallet must be connected to withdraw. You will confirm transaction in your wallet.</div>
          <button id="withdrawBtn" class="small btn-primary" style="margin-top:8px" disabled>Withdraw TON</button>
        </div>

        <div id="upgradesContainer"></div>

        <div style="margin-top:12px" class="muted">Auto income: <span id="autoIncome">0</span>/s</div>
        <div class="muted" style="margin-top:6px">Tap power: <span id="tapPower">1</span></div>

        <div style="margin-top:12px">
          <h4 style="margin:6px 0">Ad Rewards</h4>
          <div class="ad-buttons">
            <button class="small" id="ad3">3 ads â†’ 50</button>
            <button class="small" id="ad5">5 ads â†’ 100</button>
            <button class="small" id="ad10">10 ads â†’ 350</button>
          </div>
          <div id="adProgress" class="muted" style="margin-top:8px">Progress: â€”</div>
        </div>
      </aside>
    </div>

    <div class="footer">Tip: Connect wallet, choose package, confirm transaction in your wallet â€” coins will be deducted after success.</div>
  </div>

  <script>
    const OWNER_WALLET = "UQCw7qsZfDdBhFcJCZh8LzA85nVXcOK7UmquWiAbX3dZGlpZ";
    const MANIFEST_URL = "https://your-domain.com/tonconnect-manifest.json";

    const state = {
      coins: Number(localStorage.getItem('hk_coins')) || 0,
      tapPower: Number(localStorage.getItem('hk_tappower')) || 1,
      autoIncome: Number(localStorage.getItem('hk_autoincome')) || 0,
      energy: Number(localStorage.getItem('hk_energy')) || 10,
      maxEnergy: 10,
      level: Number(localStorage.getItem('hk_level')) || 1,
      boostActive: false,
      tonConnected: false,
      tonAccount: null
    };

    const coinsEl = document.getElementById('coins');
    const energyText = document.getElementById('energyText');
    const energyBar = document.getElementById('energyBar');
    const levelEl = document.getElementById('level');
    const upgradesContainer = document.getElementById('upgradesContainer');
    const adProgressEl = document.getElementById('adProgress');
    const walletAddressEl = document.getElementById('walletAddress');
    const convertSelect = document.getElementById('convertSelect');
    const withdrawBtn = document.getElementById('withdrawBtn');
    const selectedInfo = document.getElementById('selectedInfo');

    const adProgress = { '50':0, '100':0, '350':0 };
    const adRequirements = { '50':3, '100':5, '350':10 };

    const upgrades = [
      { id:'tap-1', name:'Tap +1', cost:50, apply:()=> state.tapPower += 1 },
      { id:'tap-5', name:'Tap +5', cost:300, apply:()=> state.tapPower += 5 },
      { id:'auto-1', name:'Auto +1/s', cost:200, apply:()=> state.autoIncome += 1 },
      { id:'auto-5', name:'Auto +5/s', cost:1200, apply:()=> state.autoIncome += 5 }
    ];

    function saveState(){
      localStorage.setItem('hk_coins', state.coins);
      localStorage.setItem('hk_tappower', state.tapPower);
      localStorage.setItem('hk_autoincome', state.autoIncome);
      localStorage.setItem('hk_energy', Math.floor(state.energy));
      localStorage.setItem('hk_level', state.level);
    }

    function render(){
      coinsEl.textContent = Math.floor(state.coins).toLocaleString();
      document.getElementById('tapPower').textContent = state.tapPower;
      document.getElementById('autoIncome').textContent = state.autoIncome;
      energyText.textContent = `${Math.floor(state.energy)}/${state.maxEnergy}`;
      energyBar.style.width = `${Math.min(1, state.energy / state.maxEnergy) * 100}%`;
      levelEl.textContent = state.level;
      adProgressEl.textContent = `50:${adProgress['50']} / ${adRequirements['50']}  â€¢  100:${adProgress['100']} / ${adRequirements['100']}  â€¢  350:${adProgress['350']} / ${adRequirements['350']}`;
      updateWithdrawUI();
    }

    function handleTap(){
      if(state.energy <=0){ alert('No energy'); return; }
      const gain = state.tapPower * (state.boostActive?2:1);
      state.coins += gain; state.energy = Math.max(0,state.energy-1); saveState(); render();
    }

    function buyUpgrade(u){
      if(state.coins<u.cost){ alert('Not enough coins'); return; }
      state.coins -= u.cost; u.apply(); state.level++; saveState(); render();
    }

    let boostTimeout = null;
    function activateBoost(seconds=20){
      if(state.boostActive) return; state.boostActive=true; render();
      if(boostTimeout) clearTimeout(boostTimeout);
      boostTimeout=setTimeout(()=>{state.boostActive=false; render();},seconds*1000);
    }

    setInterval(()=>{
      if(state.autoIncome>0) state.coins += state.autoIncome;
      state.energy = Math.min(state.maxEnergy,state.energy+0.2);
      saveState(); render();
    },1000);

    function showAd(){
      return new Promise(resolve=>{
        if(window.show_10286020 && typeof show_10286020 === 'function'){
          try { show_10286020().then(()=>resolve(true)); } catch(e){ resolve(false); }
        } else {
          const ok = confirm('Simulate ad? Click OK.');
          setTimeout(()=>resolve(ok),1000);
        }
      });
    }

    async function watchAdForReward(rewardAmount){
      const req=adRequirements[String(rewardAmount)];
      const watched = await showAd(); if(!watched) return;
      adProgress[String(rewardAmount)]++;
      if(adProgress[String(rewardAmount)]>=req){
        state.coins += rewardAmount; adProgress[String(rewardAmount)]=0;
        alert(`${rewardAmount} coin qazandÄ±nÄ±z!`);
      }else alert(`Reklama baxÄ±ldÄ± (${adProgress[String(rewardAmount)]}/${req})`);
      saveState(); render();
    }

    function setupUI(){
      document.getElementById('tapBtn').addEventListener('click', handleTap);
      document.getElementById('refillBtn').addEventListener('click', ()=>{ state.energy=state.maxEnergy; saveState(); render(); });
      document.getElementById('boostBtn').addEventListener('click', ()=>activateBoost(20));
      document.getElementById('resetBtn').addEventListener('click', ()=>{ if(!confirm('Reset everything?')) return; state.coins=0; state.tapPower=1; state.autoIncome=0; state.energy=state.maxEnergy; state.level=1; state.boostActive=false; Object.keys(adProgress).forEach(k=>adProgress[k]=0); localStorage.clear(); render(); });
      document.getElementById('shareBtn').addEventListener('click',()=>{ if(navigator.clipboard) navigator.clipboard.writeText(location.href).then(()=> alert('URL copied')); });
      document.getElementById('ad3').addEventListener('click',()=>watchAdForReward(50));
      document.getElementById('ad5').addEventListener('click',()=>watchAdForReward(100));
      document.getElementById('ad10').addEventListener('click',()=>watchAdForReward(350));

      upgradesContainer.innerHTML='';
      upgrades.forEach(u=>{
        const div=document.createElement('div'); div.className='upgrade';
        div.innerHTML=`<div><div style="font-weight:600">${u.name}</div><div class="muted">Cost: ${u.cost}</div></div>`;
        const btn=document.createElement('button'); btn.className='small btn-primary'; btn.textContent='Buy';
        btn.addEventListener('click',()=>buyUpgrade(u)); div.appendChild(btn); upgradesContainer.appendChild(div);
      });
    }

    const ui = new TON_CONNECT_UI.TonConnectUI({ manifestUrl: MANIFEST_URL, buttonRootId: 'connectWalletBtn' });

    ui.onStatusChange((wallet) => {
      if(wallet){
        state.tonConnected = true;
        state.tonAccount = wallet.account;
        walletAddressEl.textContent = "Wallet: " + wallet.account.address;
      } else {
        state.tonConnected = false;
        state.tonAccount = null;
        walletAddressEl.textContent = "Wallet not connected";
      }
      updateWithdrawUI();
    });

    function coinsToTon(coins){
      const map = { 10000:0.1, 30000:0.3, 50000:0.5, 100000:1.0, 300000:3.0, 500000:5.0, 1000000:10.0 };
      return map[coins] ?? 0;
    }

    function updateWithdrawUI(){
      const needed = Number(convertSelect.value);
      const tonAmount = coinsToTon(needed);
      selectedInfo.textContent = `Selected: ${needed.toLocaleString()} coins â†’ ${tonAmount} TON. Your coins: ${Math.floor(state.coins).toLocaleString()}. Wallet: ${state.tonConnected ? state.tonAccount.address : 'not connected'}.`;
      withdrawBtn.disabled = !(state.tonConnected && state.coins >= needed);
    }

    convertSelect.addEventListener('change', updateWithdrawUI);

    withdrawBtn.addEventListener('click', async ()=>{
      const needed = Number(convertSelect.value);
      const tonAmount = coinsToTon(needed);
      if(state.coins < needed){ alert('Not enough coins'); return; }
      if(!state.tonConnected){ alert('Connect your TON wallet first'); return; }

      const amountNano = String(Math.round(tonAmount * 1_000_000_000));
      try{
        withdrawBtn.disabled = true;
        withdrawBtn.textContent = 'Waiting for wallet...';
        await ui.sendTransaction({ validUntil: Math.floor(Date.now()/1000) + 300, messages: [{ address: OWNER_WALLET, amount: amountNano }] });
        state.coins -= needed; if(state.coins<0) state.coins=0;
        saveState(); render();
        alert(`Success â€” you sent ${tonAmount} TON to owner. ${needed.toLocaleString()} coins deducted.`);
      }catch(err){
        console.error('Withdraw tx failed or rejected:', err);
        alert('Transaction failed or rejected.');
      }finally{
        withdrawBtn.textContent = 'Withdraw TON';
        updateWithdrawUI();
      }
    });

    setupUI();
    render();

    if(MANIFEST_URL.includes('your-domain')){
      console.warn('Please host your tonconnect-manifest.json and replace MANIFEST_URL with its URL. TonConnect may not work without a valid manifest.');
    }
  </script>
</body>
</html>
